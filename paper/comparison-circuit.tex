As explained in Section \ref{sec:background}, the comparison of elements over $\mathbb{F}_{p^d}$ boils down to their comparison over $\mathbb{F}_p$. In this section we study the structure of the comparison circuit over $\mathbb{F}_p$. As a consequence, in this section, $\S$ is restricted to $[0,p-1]$ in which case we have for any $(x,y)\in\S^2\subseteq \F_p^2$:

$$ \EQ_{\S}(x,y) = 1 - (x-y)^{p-1}. $$

Unfortunately, the comparison function is not as simple and we have to rely on Lagrange interpolation (Lemma 1) to compute it. Yet, there are two different ways to evaluate it: either interpolate $\LT_\S$ as a bivariate function over $S^2$ -- i.e. compute $\LT_\S(x,y)$ -- as done in \cite{TLWRK20}, or transform it as a simple univariate function in $z = x - y$ -- i.e. compute $\LT_S (z, 0)$ -- as done in \cite{AINA:NGEG17} and \cite{PoPETS:SFR20}. However, all these works have evaluated $\LT_\S$ without exploiting its structure. In this Section we study this structure for both the bivariate and univariate cases and we show how to exploit it in order to speed-up their evaluation.


\subsection{Bivariate interpolation of $\LT_\S$.}

  The less-than function can be interpolated using Lemma~\ref{lem:interpolation} and the following truth table
  $$\begin{array}{c|m{1em}m{1em}m{1em}cc}
      < & 0 & 1 & 2 & \cdots & p-1 \\
      \hline
      0 & 0 & 1 & 1 & \cdots & 1 \\
      1 & 0 & 0 & 1 & \cdots & 1 \\
      2 & 0 & 0 & 0 & \cdots & 1 \\
      \vdots & \vdots & \vdots & \vdots & \ddots & \vdots \\
      p-1 & 0 & 0 & 0 & \cdots & 0 \\
    \end{array}$$
    
  In particular it can be interpolated by:
  \begin{align}\label{eq:less_than_function}
    P_{\LT_\S}(x,y) & = \sum_{a = 0}^{p-2} \EQ_\S(x,a)\sum_{b = a+1}^{p-1} \EQ_\S(y,b) \nonumber\\
                &= \sum_{a = 0}^{p-2} (1-\princhar_p(x - a)) \sum_{b = a+1}^{p-1} (1-\princhar_p(y - b)) \nonumber \\
                &= \sum_{a = 0}^{p-2} (1-(x - a)^{p-1}) \sum_{b = a+1}^{p-1} (1-(y - b)^{p-1}).
  \end{align}

  From Eq (\ref{eq:less_than_function}), it appears that $P_{\LT_\S}$ has degree at most $p-1$ in each variable and so, at first sight, it seems to have total degree at most $2p - 2$. It appears that this is not the case:
  \begin{theorem} \label{thm:less_than_total_degree}
    Let $p>2$ be a prime number and $\S = [0,p-1]$, then $P_{\LT_\S}$ is a polynomial over $\F_p$ of the following form:
    \begin{align*}
      P_{\LT_\S}(x,y) = y^{p-1} - \frac{p-1}{2} (xy)^{\frac{p-1}{2}} + \sum_{\substack{i,j>0 \\ i+j \le p}} a_{ij} x^i y^j 
    \end{align*}
    where $a_{ij} = \sum_{a=0}^{p-2} \sum_{b=a+1}^{p-1} a^{p-1-i} b^{p-1-j} \in \F_p$. In particular, it has total degree at most $p$.
  \end{theorem}

  \begin{proof}
    See Appendix \ref{proof_thm_less_than_total_degree}.
  \end{proof}

  Now that we have a better idea of what $P_{\LT_\S}$ looks like we are gonna enumerate some obvious facts which worth being stated:
  \begin{itemize}[label=--]
  \item $P_{\LT_\S} (x, 0) = 0$ thus $y$ divides $P_{\LT_\S} (x, y)$.
  \item $P_{\LT_\S} (x, x) = P_{\LT_\S} (y,y) = 0$ thus $(x - y)$ divides $P_{\LT_\S} (x, y)$.
  \item $P_{\LT_\S} (p-1, y)=0$ thus $x + 1$ divides $P_{\LT_\S} (x, y)$.
  
  \end{itemize}
  Therefore there exists a bivariate polynomial $f$ of total degree $p - 3$ over $\F_p$ such that:
  \begin{equation}
    \label{eq:decomposition-LT}
    P_{\LT_\S} (x, y) = y(x - y)(x + 1)f(x, y) \bmod p.
  \end{equation}

  We will now be interested in the structure of the polynomial $f$.

  \begin{theorem}\label{thm:decomposition-f}
    Let $p$ be an odd prime, for any $z\in\F_p$ we have:
    \begin{equation}
      \label{eq:3}
       f(z,z) = f(z,0) = f(p-1,z).
    \end{equation}
    As a consequence, when $p>3$ there exists a bivariate polynomials $f_1$ of total degree $p-5$ over $\F_p$ such that:
    \begin{align}
      \label{eq:dec-f}
      f(x,y) &= f(x,0) + y(x-y)f_1(x,y) \\
      &= f_0(x) + y(x-y)f_1(x,y).
    \end{align}   
    This decomposition can be applied recursively to $f_1$, so that there exists $(p-1)/2$ polynomials $f_i$ over $\mathbb{F}_p$, $0\leq i \leq (p-3)/2$, such that:

    \begin{align}\label{eq:decomposition-f-final}
      f_0(x,y) = \sum_{i=0}^{(p-3)/2} f_i(x)Y^i,
    \end{align}
    with $Y=y(x-y)$ and $\deg (f_{i}(x)) = p-3 - 2i$.

    % or equivalently a bivariate polynomials $f'_1$ of total degree $p-5$ over $\F_p$ such that:
    % \begin{equation}
    %   \label{eq:dec-f'}
    %   f(x,y) = f(p-1,y) + (x+1)(x-y)f'_1(x,y)
    % \end{equation}    
  \end{theorem}  

  Our proof of Theorem \ref{thm:decomposition-f} is quite long and with no real interest for the purpose of this work. Therefore we defer it to an extended version of this paper. This decomposition can be easily found numerically, we give the formulae of $f$ for small values of $p$ in Appendix \ref{app:decomposition-f}.\newline
  
%   In order to show Eq. (\ref{eq:3}) we will need the following lemma:

%   \begin{lemma}\label{lem:structure-f}
%     Let $p>3$ be an odd prime, $i\in[0,p-2]$ and $f$ be the polynomial defined in Eq. (\ref{eq:decomposition-LT}), then for any $z\in[0,p-1]$ we have:

%     $$ f(i,z) = f(p-1-z,p-1-i) = -\displaystyle\sum_{k=i+1}^{p-1}\frac{1-(z-k)^{p-1}}{(i+1)z(z-i)} \bmod p.$$
%   \end{lemma}

%   \begin{proof}
%     We know that for any $z\in[0,p-1]$ we have:
%     $$\LT_\S(i,z) = \left\{
%       \begin{array}{l}
%         0 ~\text{ if }~ 0\leq z\leq i \\
%         1 ~\text{ otherwise}~
%       \end{array}
%     \right.$$
%     Note that since $i<p-1$, $\LT_\S(i,\cdot)$ is not the zero function. It can be interpolated by the univariate polynomial:
%     $$P_{\LT_\S}(i,z) = \displaystyle\sum_{k=i+1}^{p-1}\left[1-(z-k)^{p-1}\right] \bmod p. $$
    
%     Similarly:
%     \begin{align*}
%       P_{\LT_\S}(x,p-1-i) &= \displaystyle\sum_{k=0}^{p-2}\left[1-(x-k)^{p-1}\right]\displaystyle\sum_{l=k+1}^{p-1}\left[1-(p-1-i-l)^{p-1}\right] \\
%                           &= \displaystyle\sum_{k=0}^{p-2-i}\left[1-(x-k)^{p-1}\right]  \bmod p
%     \end{align*}
%     So:
%     \begin{align*}
%       P_{\LT_\S}(p-1-z,p-1-i) &= \displaystyle\sum_{k=0}^{p-2-i}\left[1-(p-1-z-k)^{p-1}\right]  \bmod p \\
%                               &= \displaystyle\sum_{k=i+1}^{p-1}\left[1-(k-z)^{p-1}\right]  \bmod p \\
%                               &= \displaystyle\sum_{k=i+1}^{p-1}\left[1-(z-k)^{p-1}\right]  \bmod p \\
%                               &=  P_{\LT_\S}(i,z) \bmod p.
%     \end{align*}
%     Now let $A$ be the bivariate polynomial defined over $\F_p$ by:
%     $$A(x,y) = y(x-y)(x+1).$$
%     We have:
%     \begin{align*}
%       A(p-1-z,p-1-i) &= -(i+1)(-z+i)(-z) \bmod p \\
%                      &= -(i+1)z(z-i) \bmod p\\
%                      &= A(i,z) \bmod p.
%     \end{align*}
%     Again, note that since $i < p-1$, $A(i,z)\neq 0 \bmod p$.
    
%     Starting from Eq. (\ref{eq:decomposition-LT}) we can write:
%     \begin{align*}
%       P_i(z) =& A(i,z)f(i,z) = A(p-1-z,p-1-i)f(p-1-z,p-1-i) \bmod p \\
%       \Leftrightarrow & A(i,z)f(i,z) - A(p-1-z,p-1-i)f(p-1-z,p-1-i) = 0 \bmod p \\
%       \Leftrightarrow & A(i,z)(f(i,z) - f(p-1-z,p-1-i)) = 0 \bmod p
%     \end{align*}
%     Given that $A(i,z)\neq 0 \bmod p$ and that $\F_p[z]$ is an integral domain we obtain what we want:

%     $$ f(i,z) = f(p-1-z,p-1-i) \bmod p. $$

%     The last equality is obtained by dividing $P_{LT_\S}(i,z)$ with $A(i,z)\neq 0 \bmod p$.
%   \end{proof}
%   Now we can start the proof of Theorem \ref{thm:decomposition-f}.
%   \begin{proof}[Theorem \ref{thm:decomposition-f}]
%     Equation (\ref{eq:3}) says that the first column, the last line and the descending diagonal of the table of values of $f$ are equals (cf. Table \ref{tab:values-f}).
%     \begin{table}[h]
%       \centering
%       \begin{tabular}{m{1.5em}|m{1em}m{1em}m{1em}m{1em}m{1em}m{1em}c}
%         \backslashbox{$x$}{$y$} & 0 & 1 & 2 & 3 & 4 & 5 & 6 \\
%         \hline
%         0 & \bf{0} & 6 & 5 & 3 & 3 & 5 & 6 \\
%         1 & \bf{4} & \bf{4} & 5 & 4 & 2 & 4 & 5 \\
%         2 & \bf{2} & 0 & \bf{2} & 3 & 2 & 3 & 2 \\
%         3 & \bf{2} & 0 & 0 & \bf{2} & 3 & 4 & 3 \\
%         4 & \bf{2} & 0 & 0 & 0 & \bf{2} & 5 & 5 \\
%         5 & \bf{4} & 0 & 0 & 0 & 0 & \bf{4} & 6 \\
%         6 & \bf{0} & \bf{4} & \bf{2} & \bf{2} & \bf{2} & \bf{4} & \bf{0} \\
%       \end{tabular}
%       \vspace{1em}\caption{Values $f(x,y)$ for $x,y\in\F_7$.}
%       \label{tab:values-f}
%     \end{table}
    
%     Lemma \ref{lem:structure-f} says that for any $0\leq i< p-1$ the $i$-th row (starting from $y=0$) and the $p-1-i$-th column (starting from $x=p-1$) of the table are equals. Another consequence of Lemma \ref{lem:structure-f} is that the values on any descending diagonal of the table form a palindrome (i.e. the values in the table are symmetric around the axis $x = p-1-y$). This is true in particular for the main descending diagonal $(x=y)$.

%     Now let us show that for any $0\leq i < p-1$ we have $f(i,0) = f(i,i)$. The case $i=0$ is trivial, for $i>0$ we know from Lemma \ref{lem:structure-f} that:
%     $$ f(i,z) = -\displaystyle\sum_{k=i+1}^{p-1}\frac{1-(z-k)^{p-1}}{(i+1)z(z-i)} \bmod p, $$
%     which can be rewritten modulo $p$ as:
%     \begin{align*}
%       f(i,z) & = -\frac{p-1-i - \displaystyle\sum_{k=i+1}^{p-1}(z-k)^{p-1}}{(i+1)z(z-i)} = -\frac{p-1-i - \displaystyle\sum_{k=i+1}^{p-1}\displaystyle\sum_{j=0}^{p-1}z^j k^{p-1-j}}{(i+1)z(z-i)} \\
%              & = -\frac{p-1-i - \displaystyle\sum_{j=0}^{p-1}\left(\displaystyle\sum_{k=i+1}^{p-1} k^{p-1-j}\right)z^j}{(i+1)z(z-i)}  = \frac{\displaystyle\sum_{j=1}^{p-1}\left(\displaystyle\sum_{k=i+1}^{p-1} k^{p-1-j}\right)z^{j-1}}{(i+1)(z-i)}.
%     \end{align*}
%     Similarly:
%     \begin{align*}
%       f(i,z) & = -\frac{p-1-i - \displaystyle\sum_{k=1}^{p-1-i}(z-i-k)^{p-1}}{(i+1)z(z-i)} = -\frac{p-1-i - \displaystyle\sum_{k=1}^{p-1-i}\displaystyle\sum_{j=0}^{p-1}(z-i)^j k^{p-1-j}}{(i+1)z(z-i)} \\
%              & = -\frac{p-1-i - \displaystyle\sum_{j=0}^{p-1}\left(\displaystyle\sum_{k=1}^{p-1-i} k^{p-1-j}\right)(z-i)^j}{(i+1)z(z-i)}  = \frac{\displaystyle\sum_{j=1}^{p-1}\left(\displaystyle\sum_{k=1}^{p-1-i} k^{p-1-j}\right)(z-i)^{j-1}}{(i+1)z}
%     \end{align*}

%     So for any $0 < i < p-1$, from the first expression we obtain:
%     $$f(i,0) = -\frac{\sum_{k=i+1}^{p-1} k^{p-2}}{i(i+1)},$$
%     from the second expression we get:
%     \begin{align*}
%       f(i,i) &= \frac{\sum_{k=1}^{p-1-i} k^{p-2}}{i(i+1)} = \frac{\sum_{k'=i+1}^{p-1} (p-k')^{p-2}}{i(i+1)} = \frac{\sum_{k'=i+1}^{p-1} (-k')^{p-2}}{i(i+1)} \bmod p \\
%       &= -\frac{\sum_{k'=i+1}^{p-1} (k')^{p-2}}{i(i+1)} = f(i,0).
%     \end{align*}

%     At this point we have shown that for $0\leq i<p-1$ we have $f(i,0) = f(i,i)$. 
%     This means that the first column and the descending diagonal are equals up to the last line. 
%     Since the values of the descending diagonal form a palindrome, the same applies to the values of the first column and thus of the last line. More precisely, for any $0\leq i < p-1$ we have:
%     $$f(i,0) = f(i,i) = f(p-1-i, p-1-i) = f(p-1-i, 0) = f(p-1, i)$$

%     At this point the last thing we have to prove to get Eq. (\ref{eq:3}) is that $f(0,0) = f(p-1,0) = f(p-1,p-1) \bmod p$. Lemma \ref{lem:structure-f} already gives us $f(0,0) = f(p-1,p-1)$, so we just have to prove the last one.

%     We have:
%     $$ P_{\LT_\S}(0,z)  = -\sum_{j=1}^{p-1}\left(\sum_{k=1}^{p-1}k^{p-1-j}\right)z^j  = z^{p-1} \bmod p \text{ (cf. Lemma \ref{lem:sum_poly}).} $$

%     Moreover, let $A(x,y) = y(x-y)(x+1)$, we have $A(0,z) = -z^2$. So from Eq.~(\ref{eq:decomposition-LT}) we obtain $f(0,z) = -z^{p-3}$ and so $f(0,0) = f(p-1,p-1) = -1 \bmod p$ if $p = 3$ and $0$ otherwise.

%     To conclude we have to show that $f(p-1,0) = -1 \bmod p$ if $p=3$ and $0$ otherwise. 
%     Since both $A$ and $\LT_\S$ vanish on the first column of the table ($y=0$) and the last line ($x=p-1$) we cannot use their values on these lines to derive the value of $f(p-1,0)$. So this time we will estimate $\LT_\S$ and $A$ on the ascending diagonal. Since $A(p-1-z,z) = z^2(1+2z) \bmod p$ if we want to prove that $f(p-1,0) = 0 \bmod p$ (resp. $1$ if $p=3$) we have to show that the coefficients of degree $0$, $1$ and $2$ of $P_{\LT_\S}(p-1-z,z)$ are equals to $0$, (resp $0, 1$ are equals to $0$ and the coefficient of degree $2$ is equal to $-1$).

%     By definition, $\LT_\S(p-1,0) = P_{LT_\S}(p-1,0) = 0 \bmod p$, so the coefficient of degree $0$ is equal to $0$. Now let us have a look at the formal derivative of $P_{\LT_\S}(p-1-z,z)$. We have: 
%     $$ P_{LT_\S}(p-1-z,z) = \sum_{k=0}^{p-2}\underbrace{[1-(1+z+k)^{p-1}]}_{=g_k(z)}\underbrace{\sum_{l=k+1}^{p-1}[1-(z-l)^{p-1}]}_{=h_k(z)} \bmod p $$
 
%   For $0\leq k \leq p-2$, we have $g_k(0) = 1-(1+k)^{p-1} = 0 \bmod p$, and also $h_k(0) = \sum_{l=k+1}^{p-1}[1-l^{p-1}] = 0 \bmod p$ since $0<l\leq p-1$. 

% Therefore $P'_{LT_\S}(p-1,0) = \sum_{k=0}^{p-2}\left(g_k'(0)h_k(0) + g_k(0)h'_k(0) \right) = 0 \bmod p$ therefore the coefficient of degree $1$ is also equal to $0$. 

% Now let us consider the formal derivative at the second order of $P_{\LT_\S}(p-1-z)$:
% $$P''_{\LT_\S}(p-1-z,z) = \sum_{k=0}^{p-2}\left(g_k''(z)h_k(z) + 2g_k'(z)h'_k(z) + g_k(z)h''_k(z) \right).$$
% Thus in $z=0$ we obtain: 
% \begin{align*}
%   P''_{\LT_\S}(p-1,0) & = 2\sum_{k=0}^{p-2}g_k'(0)h'_k(0) = -2\sum_{k=0}^{p-2}(1+k)^{p-2}\sum_{l=k+1}^{p-1}l^{p-2} \\
%                       &= -2\left(\sum_{k=1}^{(p-1)/2}k^{p-2}\sum_{l=k}^{p-1}l^{p-2} + \sum_{k=(p+1)/2}^{p-1}k^{p-2}\sum_{l=k}^{p-1}l^{p-2}\right) \\
%                       & = -2\left(\sum_{k=1}^{(p-1)/2}k^{p-2}\sum_{l=k}^{p-1}l^{p-2} + \sum_{k=1}^{(p-1)/2}(-k)^{p-2}\sum_{l=p-k}^{p-1}l^{p-2}\right) \\
%                       & = -2\sum_{k=1}^{(p-1)/2}k^{p-2}\left(\sum_{l=k}^{p-1}l^{p-2} -  \sum_{l=p-k}^{p-1}l^{p-2}\right) \\
%                       & = -2\sum_{k=1}^{(p-1)/2}k^{p-2}\sum_{l=k}^{p-1-k}l^{p-2} = -2\sum_{k=1}^{(p-1)/2}k^{2p-4} \\
%                       & = -2\sum_{k=1}^{(p-1)/2}k^{p-3} = -\sum_{k=1}^{(p-1)/2}k^{p-3} - \sum_{k=1}^{(p-1)/2}(-k)^{p-3} \\
%                       & = -\sum_{k=1}^{p-1}k^{p-3}  \bmod p\\
%                       & = 1 ~\text{ if } p = 3 ~\text{ and }~ 0 ~\text{ otherwise.}
% \end{align*}
% The coefficient of degree 2 is equal to $P''_{\LT_\S}(p-1,0)/2 = -1 \bmod 3$.
% Thus overall $f(p-1,0) = f(p-1,p-1) = f(0,0)$ and we have proved Eq. (\ref{eq:3}). The rest of the theorem is straightforward:
% \begin{itemize}
% \item $y$ and $(x-y)$ divide $f(x,y)-f(x,0) = f(x,y)-f(x,x) \bmod p$ which implies (\ref{eq:dec-f}). 
% \item $x+1$ and $(x-y)$ divide $f(x,y)-f(p-1,y) = f(x,y)-f(y,y) \bmod p$ which implies (\ref{eq:dec-f'}).
% \end{itemize}
% Note that when $p=3$ $f(x,y) = 1 \bmod p.$
% \end{proof}

\paragraph{Complexity analysis}
In \cite{TLWRK20}, the authors proposed to evaluate $P_{\LT_S}(x,y)$ by evaluating each monomials separately before summing them up. This requires to precompute the powers of $x$ and $y$ up to $p-1$ for a total of $2p-4$ non-scalar multiplications. Then one need another $p-1$ non-scalar multiplications to evaluate each monomial $((\sum_i c_i x^i)y^j)_{j}$ where the $c_i$s are scalars in $\F_p$, before summing them together to get the final result. Overall their evaluation of $P_{\LT_\S}$ requires $3p-5$ non-sclar multiplications. \newline

Following the idea of \cite{TLWRK20} and using the decomposition of $f$ given in Eq. (\ref{eq:decomposition-f-final}) one needs:
\begin{itemize}
\item $2$ multiplications to get $(x+1)Y$ for $p\geq 3$ and only $1$ when $p=2$;
\end{itemize}
and then for $p\geq 5$:
\begin{itemize}
\item $p-4$ multiplications to compute the $x^i$s for $2\leq i \leq p-3$ required to compute the terms $f_i(x,0)$;
\item $(p-5)/2$ multiplications to compute the $Y^i$ for $2\leq i \leq (p-3)/2$;
\item $(p-3)/2$ multiplications to compute the products $f_i(x,0)\cdot Y^i$;
\item $1$ final multiplication to multiply $f$ and $(x+1)Y$.
\end{itemize}

Thus overall, for $p\geq 5$, one needs at most $2p-5$ non scalar multiplications to evaluate $P_{\LT_\S}(x,y)$ homomorphically. Actually by optimising the way of computing the $f_i$ this number can be slightly reduced. For instance for $p=5$ and $7$ it can be done using only $4$ and $6$ multiplications respectively (see Appendix \ref{app:decomposition-f}), hence for a prime $2\leq p \leq 7$, $P_{\LT_\S}(x,y)$ can be computed with only $p-1$ non-scalar multiplications.

Overall, for $p\geq 5$, our method saves $p$ multiplications over the method of \cite{TLWRK20}. However its complexity remains linear in $p$ which is unpractical for performing homomorphic comparisons using large digits (and thus a large $p$).
  
\subsection{Univariate interpolation of $\LT_\S$}
The linear complexity for evaluating the bivariate circuit comes from the fact that it is bivariate. However it is possible to evaluate univariate polynomials of degree $p-1$ in $\mathcal{O}(\sqrt{p})$ non scalar multiplications using \cite{SIAM:PS73}. Therefore it would be interesting to be able to evaluate $\LT_S$ using a univariate polynomial. This can be achieved by computing the difference $x-y$ of the two values to compare and find its sign.
  To compute the sign function (or $\LT_\S(x-y,0)$) using finite field arithmetic, we need to split finite field elements into two classes:  negative ($\F_p^-$) and non-negative ($\F_p^+$).
  In addition, for any $x, y \in \S$ the following property should hold:
  \begin{align*}
    x - y \in 
    \begin{cases}
      \F_p^+ \text{ if } \LT_\S(x,y) = 0, \\
      \F_p^- \text{ if } \LT_\S(x,y) = 1.
    \end{cases}
  \end{align*}   
  Let $\S = [0, (p-1)/2]$ for a prime odd integer $p$.
  Let us split $\F_p$ into $\F_p^+ = [0, (p-1)/2]$ and $\F_p^- = [-(p-1)/2, -1]$.
  Notice that for any $x, y \in \S$, their difference $x - y$ belongs to $\F_p^-$ if and only if $x < y$.
  According to Lemma~\ref{lem:interpolation}, the indicator function of $\F_p^-$ is equal to
  \begin{align*}
    \chi_{\F_p^-}(z) = \sum_{a=-\frac{p-1}{2}}^{-1} 1 - (z - a)^{p-1}.
  \end{align*}
  In other words, this function outputs $1$ if $z$ is negative and $0$ otherwise.
  Combining the above facts the $\LT_\S$ function can be interpolated by the following polynomial.
  \begin{align*}
    Q_{\LT_\S}(x,y) = \sum_{a=-\frac{p-1}{2}}^{-1} 1 - (x - y - a)^{p-1} \bmod p.
  \end{align*}
  The following lemma describes all the coefficients of $Q_{\LT_\S}$.
  \begin{lemma}\label{lem:univariate}
    For an odd prime $p$ and $\S = [0, (p-1)/2]$, the $\LT_\S$ function can be interpolated by the following polynomial over $\F_p$
    \begin{align}\label{eq:univariate_circuit}
      Q_{\LT_\S}(x,y) = \frac{p+1}{2} (x-y)^{p-1} + \sum_{i=1, \text{odd}}^{p-2} c_i (x-y)^i.
    \end{align}
    where $c_i = \sum_{a=1}^{\frac{p-1}{2}} a^{p-1-i}$.
  \end{lemma}
  \begin{proof}
    See Appendix \ref{app:proof-lem-univariate}
  \end{proof}
  \paragraph{Complexity analysis}The above lemma implies that the less-than function can be expressed by a univariate polynomial of degree $p-1$.
  In general, such polynomials are evaluated in $O(p-1)$ steps according to Horner's method.
  However, in homomorphic computation model, multiplication by a scalar coefficient is usually much cheaper then ``non-scalar'' multiplication of expressions containing input variables $x$ and $y$.
  To reduce the number of non-scalar multiplications, we can resort to the Paterson-Stockmeyer algorithm~\cite{SIAM:PS73} that requires $O(\sqrt{2(p-1)})$ such multiplications.
  However, we can improve this complexity by exploiting the fact that the polynomial in~(\ref{eq:univariate_circuit}) has only one coefficient with an even index, the leading one.
  Thus, we can rewrite~(\ref{eq:univariate_circuit}) as follows
  \begin{align*}
    \alpha_{p-1} z^{p-1} + z \sum_{i=0, \text{even}}^{p-3} \alpha_{i+1} z^i =  \alpha_{p-1} z^{p-1} + z g(z^2)
  \end{align*}
  where $z = x - y$, $\alpha_i = \sum_{a=1}^{\frac{p-1}{2}} a^{p-1-i}$ and $g(X)$ is a polynomial of degree $(p-3)/2$.
  To evaluate $g(X)$, the Paterson-Stockmeyer algorithm requires $O(\sqrt{p-3})$ non-scalar multiplications.
  Furthermore, the preprocessing phase of this algorithm computes $z^2, z^4, \dots, z^{2k}$ and $z^{4k}, z^{8k}, \dots, z^{2^r k}$ with $2k(2^r-1) = p-3$.
  We can use these powers to compute the leading term in $m$ steps, namely
  \begin{align*}
    z^2 z^{2k} z^{4k} \cdots z^{2^r k} = z^{2 + 2k(2^r-1)} = z^{2 + p - 3} = z^{p-1}.
  \end{align*}
  Since $r \in O(\log (p/(2k)))$, the asymptotic complexity of evaluating~(\ref{eq:univariate_circuit}) is $O(\sqrt{p-3})$ non-scalar multiplications.
  
  \begin{remark}
    A careful reader can notice that the leading term of~(\ref{eq:univariate_circuit}) is equal to $\chi_p(x-y)$, which is the heaviest part of the equality circuit $\EQ_\S$.
    Thus, we can get $\EQ_\S$ almost for free (at the cost of one $\SubPlain$) after evaluating $\LT_\S$, thus saving $O(\log (p-1))$ non-scalar multiplications.

    This feature of our circuit allows to compute all the equality operations while comparing large integers using the less-than function $\LT$ from~(\ref{eq:general_lex_order}).
    This saves $O((d'-1)(k-1) \log (p-1))$ homomorphic multiplications, thus leading to a better running time.
  \end{remark}

\subsection{Min/max function}

  Given the less-than function $\LT_\S$ defined on a set $\S$, one can compute the minimum of two elements $x$ and $y$ in the following generic way
  \begin{align*}
    \min_\S(x,y) &= x \cdot \LT_\S(x,y) + y \cdot (1 - \LT_\S(x,y)) \\
    &= y + (x-y) \cdot \LT_\S(x,y)
  \end{align*}
  Notice that the difference $x - y$ naturally emerges in this expression, thus hinting that the univariate circuit from~(\ref{eq:univariate_circuit}) might be useful here.
  Indeed, by replacing $x - y$ with an indeterminate $z$ we obtain the univariate polynomial representation of the minimum function 
  \begin{align*}
    \min_\S(x,y) & = y + z \cdot \left(\frac{p+1}{2} z^{p-1} + \sum_{i=1, \text{odd}}^{p-2} z^i \sum_{a=1}^{\frac{p-1}{2}} a^{p-1-i}\right) \\
    & = y + \frac{p+1}{2} z + \sum_{i=1}^{\frac{p-1}{2}} z^{2i} \sum_{a=1}^{\frac{p-1}{2}} a^{p-2i} \\
    & = \frac{p+1}{2} (x+y) + \sum_{i=1}^{\frac{p-1}{2}} z^{2i} \sum_{a=1}^{\frac{p-1}{2}} a^{p-2i} \\
    & = \frac{p+1}{2} (x+y) + g(z^2)
  \end{align*}
  where $g(X)$ is a polynomial of degree $(p-1)/2$. 
  As a result, $\min(x,y)$ can be computed with $O(\sqrt{p-1})$ non-scalar multiplications via the Paterson-Stockmeyer algorithm.

  Following the above reasoning, the maximum function can be computed as follows
  \begin{align*}
    \max_\S(x,y) &= \frac{p+1}{2} (x+y) - \sum_{i=1}^{\frac{p-1}{2}} z^{2i} \sum_{a=1}^{\frac{p-1}{2}} a^{p-2i}.
  \end{align*}
  \begin{remark}
    Maximum and minimum functions are a basic building block in the neural network design.
    For example, one of the most popular activation functions in neural networks is the rectifier, or ReLU.
    The above formula for $\max_\S$ yields the following simple polynomial for the ReLU function
    \begin{align*}
      \ReLU_\S(x) = \max_\S(x,0) &= \frac{p+1}{2} x - \sum_{i=1}^{\frac{p-1}{2}} x^{2i} \sum_{a=1}^{\frac{p-1}{2}} a^{p-2i}.
    \end{align*}
  \end{remark}

% \subsection{Lexicographic order}\label{subsec:lexicographic_order}
%   Let $\vx=(x_0,x_1,\ldots,x_{\ell-1})$ and $\vy=(y_0,y_1,\ldots,y_{\ell-1}) \in \F_\fieldcard^\ell$ for the lexicographical order $<$ defined by the choice of $\S$:
%   \begin{align*}
%     \vx < \vy \Leftrightarrow \exists i\in[0,\ell-1] \text{ such that } x_i < y_i \text{ and } \forall j > i ~~ x_j = y_j\,.
%   \end{align*}
%   This order induces a function $\LT_{\F_\fieldcard}(\vx, \vy)$ that returns $1$ if $\vx < \vy$ and $0$ otherwise. 
%   As done in~\cite{TLWRK20}, we can employ $\EQ_{\F_\fieldcard}$ and $\LT_{\F_\fieldcard}$ to compute $\LT_{\F_\fieldcard}(\vx, \vy)$ as follows
%   \begin{align*}
%     \LT_{\F_\fieldcard}(\vx, \vy) = \sum_{i=0}^{\ell-2} \LT_{\F_\fieldcard}(x_{i}, y_{i}) \prod_{j=i+1}^{\ell-1} \EQ_{\F_\fieldcard}(x_{j}, y_{j}) + \LT_{\F_\fieldcard}(x_{\ell-1}, y_{\ell-1}).
%   \end{align*}
%   Notice that the multiplicative depth of this function solely depends on the products of the equality functions.
%   In fact, these products compare subvectors $\vx_i = (x_i, x_{i+1},\dots,x_{\ell-1})$ and $\vy_i = (y_i, y_{i+1},\dots,y_{\ell-1})$ for $i \in [1,\ell-1]$.
%   Thus, we can rewrite $\LT_{\F_\fieldcard}$ as
%   \begin{align}\label{eq:general_lex_order}
%     \LT_{\F_\fieldcard}(\vx, \vy) = \sum_{i=0}^{\ell-2} \LT_{\F_\fieldcard}(x_{i}, y_{i}) \EQ_{\F_\fieldcard}(\vx_{i+1}, \vy_{i+1}) + \LT_{\F_\fieldcard}(x_{\ell-1}, y_{\ell-1})
%   \end{align}
%   with the equality function $\EQ_{\F_\fieldcard}(\vx_{i+1}, \vy_{i+1})$ that returns $1$ if $\vx_{i+1} = \vy_{i+1}$ and $0$ otherwise.
%   As shown in~\todo{cite our work}, this function can be realized by a constant-depth circuit in the following way.
%   \begin{align}\label{eq:rand_eq_circuit}
%     \EQ_{\F_\fieldcard, e}(\vx_{i+1},\vy_{i+1}) = 1 - \princhar_{\fieldcard^e}\left(\sum_{j=i+1}^{\ell-1} r_j (x_j - y_j)\right)
%   \end{align}
%   where $r_j$ are uniformly random elements from $\F_{\fieldcard^e}$.
%   This circuit is false-biased with error probability $\fieldcard^{-e}$.
%   We can compute all $\EQ_{\F_\fieldcard, e}(\vx_{i+1},\vy_{i+1})$ using the same number of multiplications as for the single equality using Algorithm~\ref{alg:vector_equalities_circuit}.\todo{What is the complexity?}
%   \begin{algorithm}[t]
%     \KwIn{
%     $\ct_\vx$ -- a ciphertext encrypting $\vx \in \F^\ell_\fieldcard$,
%     $\ct_\vy$ -- a ciphertext encrypting $\vy \in \F^\ell_\fieldcard$.
%     }
%     \KwOut{$\ct$ -- a ciphertext containing the output of $\EQ_{\F_\fieldcard, e}(\vx_{i+1},\vy_{i+1})$ in the $i$th SIMD slot}
%     $\ct_1 \leftarrow \Shift(\ct_\vx, 1)$ // removes the value $x_0$ and shifts $\vx$ to the left\\
%     $\ct_2 \leftarrow \Shift(\ct_\vy, 1)$ // removes the value $y_0$ and shifts $\vy$ to the left\\
%     $\ct \leftarrow \Sub(\ct_1, \ct_2)$ // $(x_i - y_i), i \in [1,\ell-1]$\\
%     $r_0,r_1,\dots,r_{\ell-1} \leftarrow \udist(\F_{\fieldcard^e})$ //\todo{define uniform distribution}\\ 
%     $\pt_r \leftarrow \pt(r_0,r_1,\dots,r_{\ell-1})$\\
%     $\ct \leftarrow \ct \cdot \pt_r$ // $r_i(x_i - y_i), i \in [1,\ell-1]$\\
%     $k \leftarrow 1$// $\sum_{j=i}^{\ell-1} r_i(x_i - y_i), i \in [1,\ell-1]$\\
%     \While{$k < \ell-1$}{
%       $\ct_{tmp} \leftarrow \Shift(\ct, k)$\\
%       $\ct \leftarrow \ct + \ct_{tmp}$\\
%       $k \leftarrow 2k$\\
%     }
%     $\ct \leftarrow \Power(\ct, \fieldcard^e-1)$ //$\princhar_{\fieldcard^e}\left(\sum_{j=i}^{\ell-1} r_i(x_i - y_i)\right), i \in [1,\ell-1]$ \\
%     $\ct \leftarrow 1 - \ct$\\
%     \textbf{Return} $\ct$.
%     \caption{Homomorphic circuit computing $\EQ_{\F_\fieldcard, e}(\vx_{i+1},\vy_{i+1})$ in parallel.}\label{alg:vector_equalities_circuit}
%   \end{algorithm}
  
%   Let us go back to the lexicographic order in equation~(\ref{eq:general_lex_order}).
%   Assume that we have a ciphertext $\ct_{\LT}$ containing $\LT_{\F_\fieldcard}(x_i, y_i)$ in the $i$th slot (\todo{elaborate on that}) and the output $\ct_{\EQ}$ of Algorithm~\ref{alg:vector_equalities_circuit}.
%   We set the $\ell-1$ slot of $\ct_{\EQ}$ to $1$ and multiply it by $\ct_{\LT}$.
%   The resulting ciphertext contains all the products $\LT_{\F_\fieldcard}(x_{i}, y_{i}) \EQ_{\F_\fieldcard}(\vx_{i+1}, \vy_{i+1})$ for any $i \in [0,\ell-2]$ and $\LT_{\F_\fieldcard}(x_{\ell-1}, y_{\ell-1})$, which can be summed in the same way as in the while circuit of Algorithm~\ref{alg:vector_equalities_circuit}.
%   As a result, we obtain a ciphertext with the output of $\LT_{\F_\fieldcard}(\vx, \vy)$ in the first SIMD slot.

%   \subsubsection{Comparing large integers.}
%   Since any integer $z$ can be represented in base $\fieldcard$ as $z = \sum_{i=0}^{\ell-1} z_i q^i$, we can encode $z$ into SIMD slots as a vector $(z_0,z_1,\dots,z_{\ell-1}) \in \F_{\fieldcard}^\ell$.
%   As shown above, we can compare such vectors using the lexicographic order function in~(\ref{eq:general_lex_order}) and thus compare integers larger than $\fieldcard$.

%   \todo{Incorporate the following into the complexity analysis.} 
%   We can obtain ciphertexts encrypting $(x,x,\ldots, x)$ and $(y,y,\ldots, y)$ with $2\log_2(q-1)\texttt{Rot}$ and $2\log_2(q-1)\texttt{Add}$. 

%   From there we can obtain encryptions of $(x,x-1,\ldots, x-q-2)$ and $(y-1,y-2,\ldots, y-q-1)$ with $2\texttt{Add}$. We can apply $f$ to these vectors in parallel with a depth of $\log (p-1) + \log d$ for a cost of $2(\log (p-1) + wt(p-1) + d - 2) \texttt{Mult}$. This can be minimized by choosing $p = 2^d + 1$ for some $d$.

%   With $2$ more $\texttt{Sub}$ we obtain encryptions of $(1-f(x), 1-f(x-1), \ldots, 1-f(x-q-2))$ and $(1-f(y-1), 1-f(y-2), \ldots, 1-f(y-q-1))$. From there we can get an encryption of the different partial sums in $\log_2(q-1)\texttt{Rot}$, $\log_2(q-1)\texttt{Select}$ and $\log_2(q-1)\texttt{Add}$. The algorithm works as follow:

%   \begin{center}
%     \begin{tikzpicture}[scale=0.8]
%       \newcommand\y{-4};
      
%       \draw (0,2) -- (16,2);
%       \draw (0,0) -- (16,0);    
%       \foreach \x in {0,...,8}{
%         \draw (2*\x,0) -- (2*\x,2);
%       }
%       \foreach \x in {0,...,7}{
%         \node at (2*\x+1,1) {$x_\x$};
%       }

%       \draw (0,2+\y) -- (16,2+\y);
%       \draw (0,\y) -- (16,\y);    
%       \foreach \x in {0,...,8}{
%         \draw (2*\x,0+\y) -- (2*\x,2+\y);
%       }

%       \node at (1,1+\y) {$x_0 + x_1$};
%       \node at (3,1+\y) {$x_1 + x_2$};
%       \node at (5,1+\y) {$x_2 + x_3$};
%       \node at (7,1+\y) {$x_3 + x_4$};
%       \node at (9,1+\y) {$x_4 + x_5$};
%       \node at (11,1+\y) {$x_5 + x_6$};
%       \node at (13,1+\y) {$x_6 + x_7$};
%       \node at (15,1+\y) {$x_7$};

%       %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      
%       \draw (0,2+2*\y) -- (16,2+2*\y);
%       \draw (0,0+2*\y) -- (16,0+2*\y);    
%       \foreach \x in {0,...,8}{
%         \draw (2*\x,0+2*\y) -- (2*\x,2+2*\y);
%       }

%       \node at (1,1+2*\y) {$\begin{array}{c}
%           x_0 + x_1  \\
%           + x_2 + x_3
%         \end{array}$};
%       \node at (3,1+2*\y) {$\begin{array}{c}
%           x_1 + x_2  \\
%           + x_3 + x_4
%         \end{array}$};
%       \node at (5,1+2*\y) {$\begin{array}{c}
%           x_2 + x_3  \\
%           + x_4 + x_5
%         \end{array}$};
%       \node at (7,1+2*\y) {$\begin{array}{c}
%           x_3 + x_4  \\
%           + x_5 + x_6
%         \end{array}$};
%       \node at (9,1+2*\y) {$\begin{array}{c}
%           x_4 + x_5  \\
%           +x_6 + x_7
%         \end{array}$};
%       \node at (11,1+2*\y) {$\begin{array}{c}
%           x_5 + x_6  \\
%           + x_7
%         \end{array}$};
%       \node at (13,1+2*\y) {$x_6 + x_7$};
%       \node at (15,1+2*\y) {$x_7$};

%       %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
      
%       \draw (0,2+3*\y) -- (16,2+3*\y);
%       \draw (0,0+3*\y) -- (16,0+3*\y);    
%       \foreach \x in {0,...,8}{
%         \draw (2*\x,0+3*\y) -- (2*\x,2+3*\y);
%       }

%       \node at (1,1+3*\y) {$\begin{array}{c}
%           x_0 + x_1  \\
%                               + x_2 + x_3 \\
%                               + x_4 + x_5 \\
%                               + x_6 + x_7
%         \end{array}$};
%       \node at (3,1+3*\y) {$\begin{array}{c}
%           x_1 + x_2  \\
%                               + x_3 + x_4 \\
%                               + x_5 + x_6 \\
%                               + x_7 \\
%         \end{array}$};
%       \node at (5,1+3*\y) {$\begin{array}{c}
%           x_2 + x_3  \\
%                               + x_4 + x_5 \\
%                               + x_6 + x_7
%         \end{array}$};
%       \node at (7,1+3*\y) {$\begin{array}{c}
%           x_3 + x_4  \\
%                               + x_5 + x_6 \\
%                               +x_7
%         \end{array}$};
%       \node at (9,1+3*\y) {$\begin{array}{c}
%           x_4 + x_5  \\
%           +x_6 + x_7
%         \end{array}$};
%       \node at (11,1+3*\y) {$\begin{array}{c}
%           x_5 + x_6  \\
%           + x_7
%         \end{array}$};
%       \node at (13,1+3*\y) {$x_6 + x_7$};
%       \node at (15,1+3*\y) {$x_7$};

%       \foreach \x in {2,...,8}
%       \draw[->,thick = 2pt] (2*\x-0.1-1,2) to[bend right] (2*\x-3+0.1,2);

%       \foreach \x in {3,...,8}
%       \draw[->,thick = 2pt] (2*\x-0.1-1,2+\y) to[bend right] (2*\x-5+0.1,2+\y);

%       \foreach \x in {5,...,8}
%       \draw[->,thick = 2pt] (2*\x-0.1-1,2+2*\y) to[bend right] (2*\x-9+0.1,2+2*\y);

%   \end{tikzpicture}
%   \end{center}

%   From there we just have to compute the scalar product of the two vectors with $1\texttt{Mult} + \log_2(q-1)\texttt{Rot} + \log_2(q-1)\texttt{Add}$. \newline

%   So overall we can compute $<$ over $\mathbb{F}_q$ for $q = p^d$ in:

%   \begin{itemize}
%   \item $4\log_2 (q-1) \texttt{Rot}$
%   \item $(4\log_2 (q-1) + 4) \texttt{Add}$
%   \item $(2(\log (p-1) + wt(p-1) + d - 2) + 1) \texttt{Mult}$
%   \item $(\log_2 (q-1) + 1) \texttt{Select}$
%   \end{itemize}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
